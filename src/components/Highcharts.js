import React, { useState } from "react";
// Import Highcharts
import Highcharts from "highcharts/highstock";
import HighchartsReact from "highcharts-react-official";
import { chartOptions, dataURL } from "./includes/ChartOption";
import UserService from "../services/user.service";

export default function HighchartsGraph(props) {
    const { isGraphDataFromSocket, graphDataFromSocket, isFilterGraphData, graphDataFromFilter, device_id } = props;

    const [options, setOptions] = useState({
        ...chartOptions,
        chart: {
            type: "line",
            zoomType: "x",
            events: {
                load: loadInitialData
            }
        },
        // xAxis: {
        //     // events: {
        //     //     afterSetExtremes
        //     // },
        //     //minRange: 3600 * 1000 // one hour
        // }
    });


    function loadInitialData() {
        if (device_id != undefined) {
            UserService.GetLinkedDeviceData(device_id, "T_power_A")
                .then((res) => {
                    console.log("power initial res:", res.data)
                    let powerDataFromDB = res.data.data.deviceData
                    console.log("res Data!!!!!!!!!", powerDataFromDB)
                    let data
                    if (typeof (powerDataFromDB) != "undefined") {
                        data = Object.keys(powerDataFromDB).map(key => {
                            return ([
                                powerDataFromDB[key].time,
                                powerDataFromDB[key].value
                            ])
                            //return powerDataFromDB[key];
                        })
                    } else {
                        data = []
                    }
                    if (data.length > 0) {
                        console.log("Graph Data!!!!!", data)
                        setOptions({
                            series: [
                                {
                                    data
                                }
                            ],
                            navigator: {
                                series: {
                                    data: data
                                }
                            }
                        });
                    }
                }).catch(err => {
                    console.log(err)
                })
        }


// let data
//         fetch(dataURL)
//             .then((res) => res.ok && res.json())
//             .then((datas) => {
//                 // Add a null value for the end date
//                 datas = [].concat(datas, [
//                     [Date.UTC(2011, 9, 14, 19, 59), null, null, null, null]
//                 ]);

               
//                  data = [
//                     [
//                         883609200000,
//                         3.41,
//                         5.01,
//                         3.37,
//                         4.58,
//                         350377440
//                     ],
//                     [
//                         886287600000,
//                         4.62,
//                         5.97,
//                         4.34,
//                         5.91,
//                         246714750
//                     ],
//                     [
//                         888706800000,
//                         5.89,
//                         7.01,
//                         5.4,
//                         6.88,
//                         359023850
//                     ],
//                     [
//                         891381600000,
//                         6.87,
//                         7.41,
//                         6.17,
//                         6.85,
//                         271820440
//                     ],
//                     [
//                         893973600000,
//                         6.88,
//                         7.91,
//                         6.42,
//                         6.68,
//                         232539110
//                     ]
//                 ]

//                 console.log("initial data!!", data)

//                 setOptions({
//                     series: [
//                         {
//                             data
//                         }
//                     ],
//                     navigator: {
//                         series: {
//                             data: data
//                         }
//                     }
//                 });
//             });
    }

    function afterSetExtremes(e) {
        const { chart } = e.target;
        chart.showLoading("Loading data from server...");
        console.log("min date",Math.round(e.min))
        fetch(`${dataURL}?start=${Math.round(e.min)}&end=${Math.round(e.max)}`)
            .then((res) => res.ok && res.json())
            .then((data) => {
                setOptions({
                    series: [{ data }]
                });
                chart.hideLoading();
            })
            .catch((error) => console.error(error.message));
    }

    const optionss = {
        title: {
            text: 'My chart'
        },
        series: [{
            data: [
                [
                    883609200000,
                    3.41,
                    5.01,
                    3.37,
                    4.58,
                    350377440
                ],
                [
                    886287600000,
                    4.62,
                    5.97,
                    4.34,
                    5.91,
                    246714750
                ],
                [
                    888706800000,
                    5.89,
                    7.01,
                    5.4,
                    6.88,
                    359023850
                ],
                [
                    891381600000,
                    6.87,
                    7.41,
                    6.17,
                    6.85,
                    271820440
                ],
                [
                    893973600000,
                    6.88,
                    7.91,
                    6.42,
                    6.68,
                    232539110
                ],
                [
                    896652000000,
                    6.61,
                    7.24,
                    6.39,
                    7.16,
                    131765730
                ],
                [
                    899244000000,
                    7.22,
                    9.54,
                    7.12,
                    8.67,
                    363113460
                ],
                [
                    901922400000,
                    8.56,
                    10.92,
                    7.75,
                    7.8,
                    453200690
                ],
                [
                    904600800000,
                    7.84,
                    10.05,
                    7.65,
                    9.52,
                    270831570
                ],
                [
                    907192800000,
                    9.19,
                    10.33,
                    7.12,
                    9.28,
                    427520110
                ],
                [
                    909874800000,
                    9.39,
                    9.85,
                    7.94,
                    7.99,
                    343060580
                ],
                [
                    912466800000,
                    8,
                    10.37,
                    7.9,
                    10.23,
                    430315480
                ],
                [
                    915145200000,
                    10.53,
                    11.82,
                    9.27,
                    10.29,
                    492496450
                ],
                [
                    917823600000,
                    10.42,
                    10.48,
                    8.63,
                    8.71,
                    272422360
                ],
                [
                    920242800000,
                    8.7,
                    9.28,
                    8,
                    8.98,
                    327837940
                ],
                [
                    922917600000,
                    9.03,
                    11.78,
                    8.38,
                    11.52,
                    523648880
                ],
                [
                    925509600000,
                    11.52,
                    12.5,
                    10.25,
                    11.04,
                    306432690
                ],
                [
                    928188000000,
                    11.25,
                    12.26,
                    10.52,
                    11.58,
                    231183010
                ],
                [
                    930780000000,
                    11.59,
                    14.15,
                    11.3,
                    13.9,
                    392420750
                ],
                [
                    933458400000,
                    13.91,
                    16.46,
                    13.04,
                    16.34,
                    314432060
                ],
                [
                    936136800000,
                    16.74,
                    20.02,
                    14.36,
                    15.83,
                    646535850
                ],
                [
                    938728800000,
                    15.53,
                    20.26,
                    14.87,
                    20.03,
                    496656570
                ],
                [
                    941410800000,
                    20.01,
                    25.94,
                    19.32,
                    24.49,
                    291601320
                ],
                [
                    944002800000,
                    25.25,
                    29.5,
                    22.76,
                    25.7,
                    317571120
                ],
                [
                    946681200000,
                    26.22,
                    30.38,
                    21.78,
                    25.94,
                    418584680
                ],
                [
                    949359600000,
                    26,
                    29.98,
                    24.25,
                    28.66,
                    245109050
                ],
                [
                    951865200000,
                    29.64,
                    37.6,
                    28.47,
                    33.95,
                    287670060
                ],
                [
                    954540000000,
                    33.88,
                    34.88,
                    26.22,
                    31,
                    285806360
                ],
                [
                    957132000000,
                    31.22,
                    31.57,
                    20.44,
                    21.11,
                    337086840
                ],
                [
                    959810400000,
                    21.01,
                    28.82,
                    20,
                    26.19,
                    281225980
                ],
                [
                    962402400000,
                    26.19,
                    30.96,
                    23.44,
                    25.16,
                    198590640
                ],
                [
                    965080800000,
                    25.38,
                    30.75,
                    22.14,
                    30.47,
                    197610480
                ],
                [
                    967759200000,
                    30.39,
                    32.06,
                    10,
                    13.02,
                    501359550
                ],
                [
                    970351200000,
                    13.17,
                    13.67,
                    8,
                    9.85,
                    724477380
                ],
                [
                    973033200000,
                    9.75,
                    11.49,
                    7.91,
                    8.35,
                    279894760
                ],
                [
                    975625200000,
                    8.5,
                    8.75,
                    5.66,
                    7.46,
                    295291710
                ],
                [
                    978303600000,
                    7.42,
                    11.23,
                    7,
                    10.61,
                    436956640
                ],
                [
                    980982000000,
                    10.75,
                    20.19,
                    0.2,
                    8.99,
                    791297830
                ],
                [
                    983401200000,
                    8.97,
                    11.88,
                    8.6,
                    11.04,
                    368363080
                ],
                [
                    986076000000,
                    11.04,
                    13.55,
                    9.38,
                    12.79,
                    370893730
                ],
                [
                    988668000000,
                    12.7,
                    13.36,
                    9.65,
                    10.03,
                    251466480
                ],
                [
                    991346400000,
                    10.04,
                    12.3,
                    9.57,
                    11.4,
                    258509890
                ],
                [
                    993938400000,
                    12,
                    13.24,
                    8.93,
                    9.37,
                    293349610
                ],
                [
                    996616800000,
                    9.46,
                    10.01,
                    8.63,
                    9.29,
                    170105730
                ],
                [
                    999295200000,
                    9.29,
                    10,
                    7.25,
                    7.75,
                    178162140
                ],
                [
                    1001887200000,
                    7.75,
                    9.71,
                    4.5,
                    8.78,
                    256539400
                ],
                [
                    1004569200000,
                    8.92,
                    10.8,
                    8.63,
                    10.65,
                    185557070
                ],
                [
                    1007161200000,
                    10.65,
                    12.02,
                    10.04,
                    10.95,
                    157683680
                ],
                [
                    1009839600000,
                    11.07,
                    12.38,
                    10.12,
                    12.35,
                    289202040
                ],
                [
                    1012518000000,
                    12.34,
                    12.99,
                    10.47,
                    10.84,
                    266681880
                ],
                [
                    1014937200000,
                    10.86,
                    12.65,
                    10.86,
                    11.84,
                    177216480
                ],
                [
                    1017612000000,
                    11.74,
                    13.34,
                    11.34,
                    12.14,
                    214698760
                ],
                [
                    1020204000000,
                    12.13,
                    13.61,
                    11.06,
                    11.64,
                    206058340
                ],
                [
                    1022882400000,
                    11.67,
                    11.72,
                    7.99,
                    8.86,
                    287726830
                ],
                [
                    1025474400000,
                    8.8,
                    9.51,
                    6.89,
                    7.63,
                    276017820
                ],
                [
                    1028152800000,
                    7.64,
                    8.21,
                    6.97,
                    7.4,
                    175162930
                ],
                [
                    1030831200000,
                    7.37,
                    7.59,
                    7,
                    7.25,
                    176293650
                ],
                [
                    1033423200000,
                    7.26,
                    9.51,
                    6.5,
                    8.12,
                    219316290
                ],
                [
                    1036105200000,
                    8.04,
                    8.95,
                    7.51,
                    7.74,
                    142994560
                ],
                [
                    1038697200000,
                    7.92,
                    8.05,
                    6.91,
                    7.18,
                    168499660
                ],
                [
                    1041375600000,
                    7.18,
                    7.68,
                    6.78,
                    7.29,
                    196677140
                ],
                [
                    1044054000000,
                    7.2,
                    7.68,
                    7.03,
                    7.51,
                    127528260
                ],
                [
                    1046473200000,
                    7.5,
                    7.6,
                    7.02,
                    7.07,
                    129003480
                ],
                [
                    1049148000000,
                    7.1,
                    7.75,
                    6.21,
                    7.13,
                    251723850
                ],
                [
                    1051740000000,
                    7.05,
                    9.5,
                    7,
                    9.02,
                    327779460
                ],
                [
                    1054418400000,
                    9.01,
                    9.89,
                    8.32,
                    9.56,
                    187015640
                ],
                [
                    1057010400000,
                    9.53,
                    11.25,
                    9.24,
                    10.49,
                    165660170
                ],
                [
                    1059688800000,
                    10.5,
                    11.43,
                    9.68,
                    11.3,
                    136208890
                ],
                [
                    1062367200000,
                    11.33,
                    11.76,
                    10.05,
                    10.32,
                    167772150
                ],
                [
                    1064959200000,
                    10.37,
                    12.66,
                    7.5,
                    11.35,
                    224806690
                ],
                [
                    1067641200000,
                    11.41,
                    11.69,
                    9.93,
                    10.42,
                    160496960
                ],
                [
                    1070233200000,
                    10.47,
                    10.94,
                    9.61,
                    10.68,
                    176498390
                ],
                [
                    1072911600000,
                    10.72,
                    12.42,
                    10.62,
                    11.27,
                    265747350
                ],
                [
                    1075590000000,
                    11.29,
                    12.05,
                    10.86,
                    11.96,
                    166684420
                ],
                [
                    1078095600000,
                    11.95,
                    14.09,
                    11.79,
                    13.54,
                    360262930
                ],
                [
                    1080770400000,
                    13.53,
                    14.85,
                    12.7,
                    12.82,
                    269811170
                ],
                [
                    1083362400000,
                    12.89,
                    14.39,
                    12.75,
                    13.99,
                    173780140
                ],
                [
                    1086040800000,
                    14.08,
                    17.24,
                    13.8,
                    16.28,
                    275348130
                ],
                [
                    1088632800000,
                    16.06,
                    16.82,
                    1.65,
                    16.13,
                    325566430
                ],
                [
                    1091311200000,
                    15.48,
                    17.59,
                    14.87,
                    17.2,
                    271811760
                ],
                [
                    1093989600000,
                    17.22,
                    19.66,
                    6,
                    19.33,
                    259906100
                ],
                [
                    1096581600000,
                    19.39,
                    26.57,
                    18.33,
                    26.14,
                    552246380
                ],
                [
                    1099263600000,
                    26.23,
                    34.78,
                    26.02,
                    33.68,
                    596243090
                ],
                [
                    1101855600000,
                    33.75,
                    33.98,
                    30.8,
                    32.17,
                    555341380
                ],
                [
                    1104534000000,
                    32.51,
                    38.94,
                    31.3,
                    38.44,
                    894408930
                ],
                [
                    1107212400000,
                    38.53,
                    45.47,
                    38.29,
                    44.81,
                    747105730
                ],
                [
                    1109631600000,
                    45.04,
                    45.11,
                    38.83,
                    41.65,
                    502438390
                ],
                [
                    1112306400000,
                    41.85,
                    44.45,
                    34,
                    36.19,
                    676151260
                ],
                [
                    1114898400000,
                    36.28,
                    40.97,
                    33.12,
                    39.85,
                    447703110
                ],
                [
                    1117576800000,
                    39.56,
                    40.76,
                    35.52,
                    36.82,
                    392645490
                ],
                [
                    1120168800000,
                    36.9,
                    44.38,
                    36.29,
                    42.45,
                    353396650
                ],
                [
                    1122847200000,
                    42.62,
                    48.32,
                    42.08,
                    46.92,
                    325571100
                ],
                [
                    1125525600000,
                    46.9,
                    54.56,
                    46.09,
                    53.56,
                    424342240
                ],
                [
                    1128117600000,
                    53.45,
                    57.98,
                    45.49,
                    56.89,
                    647222030
                ],
                [
                    1130799600000,
                    57.3,
                    71.07,
                    56.87,
                    68.07,
                    465043050
                ],
                [
                    1133391600000,
                    67.45,
                    75.46,
                    67.45,
                    72.01,
                    451723100
                ],
                [
                    1136070000000,
                    72.38,
                    86.4,
                    70.87,
                    74.8,
                    759416340
                ],
                [
                    1138748400000,
                    74.6,
                    76.46,
                    62.9,
                    68.58,
                    644137810
                ],
                [
                    1141167600000,
                    68.92,
                    69.99,
                    57.67,
                    62.73,
                    799700390
                ],
                [
                    1143842400000,
                    63.27,
                    72.07,
                    60.72,
                    70.4,
                    685592720
                ],
                [
                    1146434400000,
                    70.5,
                    73.8,
                    58.69,
                    60.01,
                    532142520
                ],
                [
                    1149112800000,
                    59.54,
                    63.1,
                    55.41,
                    57.5,
                    620669920
                ],
                [
                    1151704800000,
                    57.47,
                    68.63,
                    50.32,
                    68.03,
                    584900020
                ],
                [
                    1154383200000,
                    67.95,
                    70,
                    62.2,
                    67.81,
                    604525820
                ],
                [
                    1157061600000,
                    68.14,
                    78.09,
                    67.82,
                    76.91,
                    584127800
                ],
                [
                    1159653600000,
                    77.5,
                    82.6,
                    72.6,
                    81.13,
                    462858660
                ],
                [
                    1162335600000,
                    81.07,
                    93.89,
                    77.79,
                    91.78,
                    456672920
                ],
                [
                    1164927600000,
                    91.9,
                    92.33,
                    76.77,
                    84.78,
                    555857460
                ],
                [
                    1167606000000,
                    86.33,
                    99.47,
                    81.9,
                    85.68,
                    813448950
                ],
                [
                    1170284400000,
                    85.9,
                    90.81,
                    82.21,
                    83.8,
                    412395360
                ],
                [
                    1172703600000,
                    84.86,
                    96.83,
                    83.7,
                    93.01,
                    517976970
                ],
                [
                    1175378400000,
                    94.09,
                    104.5,
                    89.29,
                    99.54,
                    471182550
                ],
                [
                    1177970400000,
                    99.75,
                    122.17,
                    98.51,
                    120.72,
                    608781190
                ],
                [
                    1180648800000,
                    120.84,
                    128.4,
                    115.4,
                    121.85,
                    813682250
                ],
                [
                    1183240800000,
                    122.47,
                    152.01,
                    119.3,
                    133.71,
                    842980730
                ],
                [
                    1185919200000,
                    131.87,
                    139.65,
                    111.46,
                    138.22,
                    853290940
                ],
                [
                    1188597600000,
                    138.67,
                    155.48,
                    130,
                    153.37,
                    740389850
                ],
                [
                    1191189600000,
                    153.03,
                    197.63,
                    152.73,
                    190.08,
                    832334150
                ],
                [
                    1193871600000,
                    189.72,
                    192.58,
                    150.63,
                    182.47,
                    936415440
                ],
                [
                    1196463600000,
                    181.8,
                    202.76,
                    176.22,
                    198.5,
                    616372640
                ],
                [
                    1199142000000,
                    199.44,
                    200.26,
                    126.14,
                    134.77,
                    1257715260
                ],
                [
                    1201820400000,
                    136.02,
                    137.89,
                    115.44,
                    124.94,
                    888925510
                ],
                [
                    1204326000000,
                    124.79,
                    145.74,
                    118,
                    143.89,
                    813267810
                ],
                [
                    1207000800000,
                    144.38,
                    180,
                    143.47,
                    174.44,
                    800619920
                ],
                [
                    1209592800000,
                    174.96,
                    192.24,
                    172,
                    188.92,
                    656041990
                ],
                [
                    1212271200000,
                    188.05,
                    190.25,
                    164.15,
                    167.9,
                    671305360
                ],
                [
                    1214863200000,
                    165.94,
                    181.27,
                    146.56,
                    158.76,
                    696246690
                ],
                [
                    1217541600000,
                    158.95,
                    180.45,
                    152.91,
                    169.36,
                    457822980
                ],
                [
                    1220220000000,
                    170.89,
                    173.5,
                    101.16,
                    113.93,
                    848774750
                ],
                [
                    1222812000000,
                    114.03,
                    116.5,
                    83.91,
                    108.03,
                    1461853840
                ],
                [
                    1225494000000,
                    108.5,
                    111.79,
                    79.14,
                    92.4,
                    835742390
                ],
                [
                    1228086000000,
                    90.95,
                    103.6,
                    84.55,
                    85.56,
                    714768840
                ],
                [
                    1230764400000,
                    86.21,
                    97.17,
                    76.09,
                    90.32,
                    642487290
                ],
                [
                    1233442800000,
                    89.41,
                    103,
                    85.25,
                    89.44,
                    489445610
                ],
                [
                    1235862000000,
                    87.3,
                    109.98,
                    82.33,
                    104.57,
                    539889630
                ],
                [
                    1238536800000,
                    104.74,
                    128.23,
                    103.88,
                    125.86,
                    412293420
                ],
                [
                    1241128800000,
                    125.9,
                    136.99,
                    118.92,
                    135.7,
                    333294420
                ],
                [
                    1243807200000,
                    135.68,
                    148.15,
                    132.88,
                    142.36,
                    444062030
                ],
                [
                    1246399200000,
                    143.01,
                    165,
                    134.42,
                    163.16,
                    386768340
                ],
                [
                    1249077600000,
                    164.8,
                    172.75,
                    159.39,
                    168.31,
                    287862040
                ],
                [
                    1251756000000,
                    168.79,
                    188.9,
                    163,
                    185.83,
                    349574490
                ],
                [
                    1254348000000,
                    184.57,
                    208.71,
                    180.21,
                    191.8,
                    447747440
                ],
                [
                    1257030000000,
                    189.59,
                    208.93,
                    185.57,
                    199.42,
                    288551050
                ],
                [
                    1259622000000,
                    200.67,
                    213.95,
                    187.93,
                    210.22,
                    389198570
                ],
                [
                    1262300400000,
                    212,
                    215.76,
                    190.25,
                    191.34,
                    525697090
                ],
                [
                    1264978800000,
                    192.4,
                    205.17,
                    190.2,
                    204.68,
                    367933230
                ],
                [
                    1267398000000,
                    206.06,
                    238.74,
                    204.64,
                    235.4,
                    401348260
                ],
                [
                    1270072800000,
                    235.24,
                    272.8,
                    232.75,
                    261.46,
                    431937490
                ],
                [
                    1272664800000,
                    262.37,
                    267.88,
                    225.21,
                    256.93,
                    639567180
                ],
                [
                    1275343200000,
                    256.81,
                    279.01,
                    242.2,
                    256.89,
                    586744960
                ],
                [
                    1277935200000,
                    252,
                    266.45,
                    239.6,
                    256.96,
                    556456950
                ],
                [
                    1280613600000,
                    258.61,
                    264.28,
                    235.56,
                    244.07,
                    338584350
                ],
                [
                    1283292000000,
                    245.51,
                    295.04,
                    243.11,
                    284.3,
                    416774140
                ],
                [
                    1285884000000,
                    285.37,
                    319.91,
                    277.77,
                    300.89,
                    431719720
                ],
                [
                    1288566000000,
                    303.59,
                    321.86,
                    297.76,
                    310.61,
                    335807840
                ],
                [
                    1291158000000,
                    312.93,
                    327.55,
                    312.93,
                    323.5,
                    240044790
                ],
                [
                    1293836400000,
                    324,
                    356.63,
                    322.56,
                    339.6,
                    380860680
                ],
                [
                    1296514800000,
                    339.73,
                    364.9,
                    335.17,
                    354,
                    324630084
                ],
                [
                    1298934000000,
                    355.02,
                    362,
                    326.26,
                    348.8,
                    397685948
                ],
                [
                    1301608800000,
                    349.4,
                    360.9,
                    320.16,
                    349.7,
                    324263468
                ],
                [
                    1304200800000,
                    352.2,
                    353.23,
                    329.42,
                    349,
                    242899300
                ],
                [
                    1306879200000,
                    348.9,
                    352.13,
                    310.5,
                    335.63,
                    324726316
                ],
                [
                    1309471200000,
                    335.3,
                    405,
                    334.2,
                    391.75,
                    375162365
                ],
                [
                    1312149600000,
                    397.46,
                    399.5,
                    345.51,
                    385.07,
                    571545253
                ],
                [
                    1314828000000,
                    385.03,
                    422.86,
                    366.48,
                    380.4,
                    423300285
                ],
                [
                    1317420000000,
                    379.96,
                    422.29,
                    354.24,
                    422,
                    237082581
                ],
                [
                    1318622340000,
                    null,
                    null,
                    null,
                    null
                ]
            ]
        }]
    }

    return (
        // <HighchartsReact
        //     constructorType={"stockChart"}
        //     highcharts={Highcharts}
        //     options={options}
        // />

        <HighchartsReact
            constructorType={"stockChart"}
            highcharts={Highcharts}
            options={options}
        />
    );
}
